<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %} {% endblock %}</title>
    <link rel="stylesheet" href="/static/dist/tailwind.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    {% block head %}{% endblock %}
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: grid;
            grid-template-rows: 40px auto 40px;
        }

        .header {
            position: relative;
            display: flex;
            align-items: center;
            background-color: rgb(52, 131, 145);
            box-shadow: 0 3px 6px 0 rgb(59, 59, 59);
        }

        .footer {
            background-color: rgb(52, 131, 145);
            box-shadow: 0 -3px 6px 0 rgb(59, 59, 59);
        }

        .menu {
            float: left;
        }

        #menu {
            fill: white;
            cursor: pointer;
            margin-left: 6px;
        }

        .user {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            float: right;
            width: 40px;
            height: 40px;
            right: 0;
            background-color: rgb(52, 172, 180);
            border-radius: 40px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2em;
            color: white;
            cursor: pointer;
        }

        .user span {
            display: flex;
            align-content: center;
        }

        .hamburger {
            position: absolute;
            top: 40px;
            background-color: rgb(52, 172, 180);
            margin: 0;
            overflow: hidden;
            font-family: Arial, Helvetica, sans-serif;
            box-shadow: 0 5px 10px 0 rgb(51, 50, 50);
            border-radius: 5px;
            z-index: 4;
        }

        .hamburger ul {
            margin-top: 10px;
            list-style: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-left: 0;
            text-wrap-mode: nowrap;
            overflow: hidden;
        }

        .hamburger li {
            display: flex;
            align-items: center;
        }

        .hamburger svg {
            margin-right: 5px;
            width: 22px;
            height: 28px;
        }

        .hamburger a {
            text-decoration: none;
            border-bottom-width: 0.2em;
            color: white;

        }

        .hamburger a:hover {
            border-bottom: solid;
            border-color: rgb(255, 255, 255);
            border-bottom-width: 0.2em;
            transition: all .2s ease-in-out;
        }

        .hamburger ul li {

            margin-bottom: 10px;
        }

        #overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            background-color: rgba(252, 250, 250, 0.64);
            z-index: 2;
        }

        .hamburger-list {
            display: none;
            float: left;
            width: 200px;
            background-color: rgb(52, 172, 180);
            margin: 12px 12px;
            border-radius: 10px;
            height: 350px;
            box-shadow: 0 3px 10px 0px black;

        }

        .hamburger-list ul {
            width: 100%;
            padding-left: 6px;
            float: left;
            list-style: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: left;
            box-sizing: border-box;

        }

        .hamburger-list a {
            text-transform: uppercase;
            text-decoration: none;
            color: white;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: .95em;
        }

        .hamburger-list a:hover {
            color: rgb(233, 236, 198);
            border-bottom: solid;
            border-color: rgb(255, 255, 255);
            border-bottom-width: 0.2em;
            transition: all .2s ease-in-out;
        }

        .hamburger-list li {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }

        .hamburger-list svg {
            margin-right: 5px;
            width: 32px;
            height: 38px;
        }

        .logo-container {
            display: flex;
            justify-self: center;
            margin: auto;
        }

        .logo {
            display: flex;
            justify-content: center;
        }

        @media screen and (min-width:870px) {
            .hamburger-list {
                display: block;
            }

            #menu {
                display: none;
            }

        }
    </style>
</head>

<body class="min-h-screen grid grid-rows-[40px_auto_40px]">
    <div class="header sticky top-0 flex items-center justify-between px-6 bg-teal-700 shadow">
        <div class="header-item menu ">

            <svg id="menu" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 96 960 960" width="32">
                <path d="M120 816v-60h720v60H120Zm0-210v-60h720v60H120Zm0-210v-60h720v60H120Z" />
            </svg>
        </div>

        <div id="user" class="header-item user">
            <span>{{user.name[0]}}</span>
        </div>
        <div id="hamburger" class="hamburger"
            style="left: 0px; width: 0px; height:fit-content; transition: width 0.5s ease-in-out; border-bottom-right-radius: 5px;text-transform: capitalize;">
            {{self.hamburger_list()}}
        </div>
        <div class="logo-container">
            <img src="/static/edgex.png" alt="edgex-logo" class="h-9 w-36 object-contain">
        </div>

        <div id="userMenu" class="hamburger"
            style="right: 0px; width: 120px; height: 0px; transition:height 0.5s ease-out; border-bottom-left-radius: 5px; text-transform: capitalize;">
            {% block hamburger %}
            <ul>
                {% if (user.admin or user.superuser) %}
                <li>
                    <a href="{{ url_for('new_course') }}">
                        <i class="fas fa-plus-circle"></i> Course
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('room') }}">
                        <i class="fas fa-door-open"></i> Room
                    </a>
                </li>
                {% endif %}
                {% if user.is_authenticated %}
                <li>
                    <a href="{{ url_for('logout') }}">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </li>>
                {% else %}
                <li>
                    <a href="{{ url_for('login') }}">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('signup') }}">
                        <i class="fas fa-user-plus"></i> Sign-up
                    </a>
                </li>
                {% endif %}
            </ul>
            {% endblock %}
        </div>


    </div>
    <div id="overlay">

    </div>
    <div class="content" >
        {% with messages=get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <center class="topic-header" style="font-size: 1.2em; text-transform: lowercase;">
            {{message}}
        </center>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="hamburger-list">
            <div class="logo" style="width: 100%;">
                <img src="/static/edgex.png" alt="edgex" height="100px" width="150px">
            </div>
            {% block hamburger_list %}
            <ul>
                <li>
                    <a href="{{url_for('home')}}"><i class="fas fa-home"></i> Home</a>
                </li>
                <li>
                    <a href="{{url_for('home')}}"><i class="fas fa-book-open"></i> Courses</a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-info-circle"></i> About</a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-envelope"></i> Contact Us</a>
                </li>
                {% if user.is_authenticated %}
                <li>
                    <a href="{{url_for('subscriptions')}}"><i class="fas fa-credit-card"></i> Subscriptions</a>
                </li>
                {% endif %}
            </ul>
            {% endblock %}
        </div>
        {% block content %}


        {% endblock %}
    </div>

    <div class="footer">
    </div>
    <script>
        const menu = document.getElementById('menu');
        const hamburger = document.getElementById('hamburger');
        console.log(hamburger)
        const overlay = document.getElementById('overlay');
        const user = document.getElementById('user');
        const userMenu = document.getElementById('userMenu');
        const links = document.getElementsByTagName('a');
        //const courseMenu = document.getElementById(id)
        //const courseIcon=document.getElementById('courseIcon')
        //const course = document.getElementById('course')

        for (let link of links) {
            if (link.getAttribute('href') == location.pathname) {
                link.className = 'active-link'
            }
            //console.log(link.getAttribute('href'))
            //console.log(location.pathname)
        }
        function courseContent(id) {
            //const id=event.target.dataset['id']
            window.location = `/courses/${id}`
        }
        function goPay(id) {
            window.location = `/payment/${id}`
        }

        function topicContent(course_id, topic_no) {
            //const id=event.target.dataset['id']
            window.location = `/courses/${course_id}/${topic_no}`
        }

        document.addEventListener('click', function (event) {
            const isCourseMenu = event.target.closest('.course-item');
            const isCourseButton = event.target.closest('.course-item-button');
            const isTopicMenu = event.target.closest('.topic-menu');
            const isTopicIcon = event.target.closest('.topic-icon');

            document.querySelectorAll('.topic-menu').forEach(topicMenu => {
                if (!isTopicMenu && !isTopicIcon) {
                    topicMenu.classList.remove('show');
                    if (!topicMenu.classList.contains('show')) {
                        topicMenu.classList.add('hidden');
                    }
                    else {
                        topicMenu.classList.remove('hidden');
                    }
                }
                if (isTopicIcon) {
                    document.querySelectorAll('.topic-menu').forEach(menu => {
                        if (menu.id === event.target.id) {
                            menu.classList.toggle('show');
                            if (menu.classList.contains('show')) {
                                menu.classList.remove('hidden');
                            } else {
                                menu.classList.add('hidden');
                            }
                        } else {
                            menu.classList.remove('show');
                            menu.classList.add('hidden');
                        }
                    });
                }
            });

            document.querySelectorAll('.course-item').forEach(courseMenu => {
                if (!isCourseMenu && !isCourseButton) {
                    courseMenu.classList.remove('show');
                    if (!courseMenu.classList.contains('show')) {
                        courseMenu.classList.add('hidden');
                    }

                }
            });

            if (isCourseButton) {
                // const itemContainer= event.target.closest('.course-item-button');
                // console.log(itemContainer);
                const courseMenus = document.querySelectorAll('.course-item');
                courseMenus.forEach(courseMenu => {
                    if (courseMenu.id === (event.target.id)) {
                        courseMenu.classList.toggle('show');
                        console.log(courseMenu.classList.contains('show'));
                        if (courseMenu.classList.contains('show')) {
                            courseMenu.classList.remove('hidden');
                        }
                        else {
                            console.log("i ran");
                            console.log(courseMenu);
                            courseMenu.classList.add('hidden');
                        }
                    }
                    else {
                        courseMenu.classList.remove('show');
                        if (!courseMenu.classList.contains('show')) {
                            courseMenu.classList.add('hidden');
                        }
                    }
                })

            }
        });



        // var courseMenuState = ''
        // function courseActions(id) {
        //     const courseMenu = document.getElementById(id)
        //     overlay.style.display = 'block'
        //     courseMenu.style.width = '80px'
        //     courseMenuState = courseMenu
        // }

        // var topicMenuState = ''
        // function topicActions(id) {
        //     const topicMenu = document.getElementById(id)
        //     overlay.style.display = 'block'
        //     topicMenu.style.width = '80px'
        //     topicMenuState = topicMenu
        // }
        var userMenuState = ''
        function userActions(id) {
            const userMenu = document.getElementById(id)
            overlay.style.display = 'block'
            userMenu.style.width = '80px'
            userMenuState = userMenu

        }

        menu.onclick = () => {
            console.log(hamburger)
            overlay.style.display = 'block'
            hamburger.style.width = '150px'
            console.log(hamburger.style.width);

        }
        overlay.onclick = (event) => {
            const courseMenu = document.getElementById(event.target.dataset['id'])
            hamburger ? hamburger.style.width = '0px' : null
            overlay.style.display = 'none'
            userMenu.style.height = '0px'
            courseMenuState ? (courseMenuState.style.width = '0') : null
            topicMenuState ? (topicMenuState.style.width = '0') : null
            userMenuState ? (userMenuState.style.width = '0') : null
        }
        user.onclick = () => {
            overlay.style.display = 'block'
            userMenu.style.height = 'fit-content'
        }
    </script>

</body>

</html>